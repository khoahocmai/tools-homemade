<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lookups Vietnamese</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:ital,wght@0,700;1,700&display=swap"
    rel="stylesheet">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            brand: '#3b82f6', // Màu xanh chủ đạo
          }
        }
      }
    }
  </script>
  <style>
    :root {
      --font-sans: 'Inter', sans-serif;
      --font-serif: 'Playfair Display', serif;
    }

    body {
      font-family: var(--font-sans);
      background-color: #f8fafc;
      /* Slate 50 */
      color: #0f172a;
      /* Slate 900 */
      transition: background-color 0.4s cubic-bezier(0.4, 0, 0.2, 1), color 0.2s;
    }

    .dark body {
      background-color: #020617;
      /* Slate 950 */
      color: #f1f5f9;
      /* Slate 100 */
    }

    .serif {
      font-family: var(--font-serif);
    }

    /* Gợi ý - Keyboard Active */
    .suggestion-item.active {
      background-color: rgba(59, 130, 246, 0.1);
      border-left: 4px solid #3b82f6;
    }

    .dark .suggestion-item.active {
      background-color: rgba(59, 130, 246, 0.2);
      border-left: 4px solid #60a5fa;
    }

    /* Hiệu ứng kính */
    .glass {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(226, 232, 240, 0.8);
    }

    .dark .glass {
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(30, 41, 59, 0.5);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 10px;
    }

    .dark ::-webkit-scrollbar-thumb {
      background: #334155;
    }
  </style>
</head>

<body class="antialiased selection:bg-blue-500/30">
  <div class="max-w-2xl mx-auto px-6 py-10 min-h-screen flex flex-col">

    <header class="flex items-center justify-between mb-8">
      <div class="space-y-1">
        <h1 class="text-3xl font-extrabold tracking-tight serif leading-tight">
          Tra cứu ngôn ngữ <br />
          <span class="text-slate-400 dark:text-slate-500 italic">vượt thời gian.</span>
        </h1>
      </div>

      <button id="themeToggle"
        class="group p-2.5 rounded-xl bg-white dark:bg-slate-900 shadow-sm border border-slate-200 dark:border-slate-800 hover:border-blue-400 transition-all">
        <i data-lucide="sun" id="sunIcon" class="hidden w-5 h-5 text-amber-500"></i>
        <i data-lucide="moon" id="moonIcon" class="w-5 h-5 text-slate-500 group-hover:text-blue-500"></i>
      </button>
    </header>

    <section class="relative z-50 mb-8">
      <div class="relative group">
        <div class="absolute inset-y-0 left-4 flex items-center pointer-events-none">
          <i data-lucide="search" class="text-slate-400 w-4 h-4 group-focus-within:text-blue-500 transition-colors"></i>
        </div>
        <input type="text" id="searchInput" placeholder="Tìm kiếm từ ngữ..." autocomplete="off"
          class="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl py-3.5 pl-12 pr-16 text-base shadow-sm focus:outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all dark:text-white" />

        <div id="loadingIndicator" class="absolute inset-y-0 right-4 flex items-center hidden">
          <div class="w-4 h-4 border-2 border-blue-500/20 border-t-blue-500 rounded-full animate-spin"></div>
        </div>
      </div>

      <ul id="suggestions"
        class="absolute top-full left-0 right-0 mt-2 glass rounded-2xl shadow-xl overflow-hidden hidden border"></ul>

      <div id="historyContainer" class="mt-5 hidden">
        <div class="flex items-center justify-between mb-2.5 px-1">
          <span class="text-[10px] font-black uppercase tracking-[0.15em] text-slate-400">Gần đây</span>
          <button id="clearHistory"
            class="text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-red-500 transition-colors">Xóa
            sạch</button>
        </div>
        <div id="historyList" class="flex flex-wrap gap-2"></div>
      </div>
    </section>

    <main id="result" class="flex-grow">
      <div id="initialState" class="py-16 flex flex-col items-center justify-center opacity-30">
        <div
          class="w-12 h-12 rounded-full border-2 border-dashed border-slate-400 flex items-center justify-center mb-3">
          <i data-lucide="feather" class="w-6 h-6 text-slate-400"></i>
        </div>
        <p class="text-xs font-medium tracking-wide">Bắt đầu nhập để khám phá</p>
      </div>
    </main>

  </div>

  <script>
    lucide.createIcons();
    const html = document.documentElement;
    const input = document.getElementById("searchInput");
    const suggestionsEl = document.getElementById("suggestions");
    const resultEl = document.getElementById("result");
    const historyListEl = document.getElementById("historyList");
    const historyContainer = document.getElementById("historyContainer");
    const loadingIndicator = document.getElementById("loadingIndicator");

    let history = JSON.parse(localStorage.getItem('vdict_v3_history') || '[]');
    let selectedIndex = -1;
    let debounceTimer;

    // Theme Logic
    const updateThemeUI = (isDark) => {
      html.classList.toggle('dark', isDark);
      document.getElementById('sunIcon').classList.toggle('hidden', !isDark);
      document.getElementById('moonIcon').classList.toggle('hidden', isDark);
    };

    const isDarkSaved = localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
    updateThemeUI(isDarkSaved);

    document.getElementById('themeToggle').onclick = () => {
      const isDark = html.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      updateThemeUI(isDark);
    };

    function updateHistoryUI() {
      if (history.length === 0) { historyContainer.classList.add('hidden'); return; }
      historyContainer.classList.remove('hidden');
      historyListEl.innerHTML = history.map(word =>
        `<button class="history-tag px-3 py-1.5 bg-white dark:bg-slate-900 hover:bg-blue-500 hover:text-white dark:hover:bg-blue-600 rounded-xl text-xs font-bold shadow-sm border border-slate-100 dark:border-slate-800 transition-all dark:text-slate-300">${word}</button>`
      ).join('');
      document.querySelectorAll('.history-tag').forEach(tag => {
        tag.onclick = () => { input.value = tag.textContent; lookup(tag.textContent); };
      });
    }

    function speak(text) {
      const msg = new SpeechSynthesisUtterance(text);
      msg.lang = 'vi-VN';
      window.speechSynthesis.speak(msg);
    }

    async function lookup(word) {
      if (!word) return;
      suggestionsEl.classList.add('hidden');
      loadingIndicator.classList.remove('hidden');
      selectedIndex = -1;

      try {
        const res = await fetch(`https://minhqnd.com/api/dictionary/lookup?word=${encodeURIComponent(word)}`);
        const data = await res.json();

        if (!data.exists) {
          resultEl.innerHTML = `
            <div class="py-12 text-center">
              <p class="text-slate-400 text-sm serif italic">Từ "${word}" hiện chưa có trong kho dữ liệu.</p>
            </div>`;
          return;
        }

        history = [data.word, ...history.filter(w => w !== data.word)].slice(0, 6);
        localStorage.setItem('vdict_v3_history', JSON.stringify(history));
        updateHistoryUI();

        let meaningsHtml = data.meanings.map(m => `
          <div class="p-5 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl shadow-sm mb-4 group hover:border-blue-500/30 transition-colors">
            <span class="text-[10px] font-black uppercase text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-500/10 px-2 py-0.5 rounded-lg mb-3 inline-block tracking-tighter">${m.pos}</span>
            <p class="text-lg font-semibold dark:text-slate-100 leading-relaxed mb-3">${m.definition}</p>
            ${m.example ? `<p class="text-sm text-slate-500 dark:text-slate-400 italic border-l-2 border-blue-200 dark:border-slate-700 pl-4 serif">"${m.example}"</p>` : ""}
          </div>
        `).join('');

        resultEl.innerHTML = `
          <div class="animate-in fade-in duration-500">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-5xl font-bold serif dark:text-white tracking-tight">${data.word}</h2>
              <button onclick="speak('${data.word}')" class="flex items-center gap-2 px-5 py-2.5 bg-slate-950 dark:bg-white text-white dark:text-slate-950 rounded-xl font-extrabold text-xs hover:scale-105 active:scale-95 transition-all shadow-lg">
                <i data-lucide="volume-2" class="w-4 h-4"></i> NGHE
              </button>
            </div>
            <div class="space-y-2">${meaningsHtml}</div>
          </div>`;
        lucide.createIcons();
      } catch (err) {
        resultEl.innerHTML = `<p class="text-center text-red-500 text-xs font-bold">⚠️ LỖI KẾT NỐI HỆ THỐNG</p>`;
      } finally { loadingIndicator.classList.add('hidden'); }
    }

    async function suggest(prefix) {
      if (!prefix) { suggestionsEl.classList.add('hidden'); return; }
      try {
        const res = await fetch(`https://minhqnd.com/api/dictionary/suggest?q=${encodeURIComponent(prefix)}`);
        const data = await res.json();
        if (!data.suggestions?.length) { suggestionsEl.classList.add('hidden'); return; }

        selectedIndex = -1;
        suggestionsEl.innerHTML = data.suggestions.map((word, idx) => `
          <li class="suggestion-item px-5 py-3 cursor-pointer text-sm font-semibold flex justify-between items-center group transition-all" data-index="${idx}">
            <span class="dark:text-slate-300 group-hover:text-blue-600 transition-colors">${word}</span>
            <i data-lucide="arrow-up-right" class="w-3.5 h-3.5 text-slate-300 group-hover:text-blue-500 opacity-0 group-hover:opacity-100 transition-all"></i>
          </li>
        `).join("");
        lucide.createIcons();
        suggestionsEl.classList.remove('hidden');

        document.querySelectorAll('.suggestion-item').forEach(li => {
          li.onclick = () => { input.value = li.querySelector('span').textContent; lookup(input.value); };
        });
      } catch (err) { }
    }

    input.addEventListener("keydown", e => {
      const items = suggestionsEl.querySelectorAll('.suggestion-item');
      if (suggestionsEl.classList.contains('hidden') || items.length === 0) {
        if (e.key === "Enter") lookup(input.value.trim());
        return;
      }
      if (e.key === "ArrowDown") {
        e.preventDefault();
        selectedIndex = (selectedIndex + 1) % items.length;
        updateSelection(items);
      } else if (e.key === "ArrowUp") {
        e.preventDefault();
        selectedIndex = (selectedIndex - 1 + items.length) % items.length;
        updateSelection(items);
      } else if (e.key === "Enter") {
        e.preventDefault();
        if (selectedIndex > -1) {
          input.value = items[selectedIndex].querySelector('span').textContent;
          lookup(input.value);
        } else {
          lookup(input.value.trim());
        }
      }
    });

    function updateSelection(items) {
      items.forEach((item, i) => item.classList.toggle('active', i === selectedIndex));
    }

    input.addEventListener("input", e => {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => suggest(e.target.value.trim()), 150);
    });

    document.getElementById('clearHistory').onclick = () => {
      history = []; localStorage.removeItem('vdict_v3_history'); updateHistoryUI();
    };

    updateHistoryUI();
  </script>
</body>

</html>