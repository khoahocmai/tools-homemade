<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8" />
  <title>TypeORM SQL Log Beautifier</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <span class="logo" aria-hidden="true">ğŸ› ï¸</span>
        <div class="brand-text">
          <h1>TypeORM SQL Log Beautifier</h1>
          <div class="subtitle">Paste logs â†’ get readable blocks (Select / From / Where / Order)</div>
        </div>
      </div>

      <div class="header-actions">
        <button id="btnThemeToggle" class="btn ghost" type="button" title="Toggle theme">
          <span class="btn-ico" aria-hidden="true">ğŸŒ™</span>
          <span class="btn-text">Theme</span>
        </button>
      </div>
    </div>

    <div class="toolbar">
      <button id="btnSaveJson" class="btn primary" type="button">ğŸ’¾ Save JSON</button>
    </div>

    <textarea id="input" placeholder="Paste TypeORM SQL logs here..." spellcheck="false"></textarea>
    <div id="output" class="output"></div>
  </div>

  <!-- Core -->
  <script defer src="./script/namespace.js"></script>
  <script defer src="./script/dom.js"></script>
  <script defer src="./script/string.js"></script>
  <script defer src="./script/highlight.js"></script>
  <script defer src="./script/format.js"></script>

  <!-- Parsers -->
  <script defer src="./script/parsers/select.js"></script>
  <script defer src="./script/parsers/from.js"></script>
  <script defer src="./script/parsers/where.js"></script>
  <script defer src="./script/parsers/insert.js"></script>

  <!-- Render helpers -->
  <script defer src="./script/render/tables.js"></script>
  <script defer src="./script/render/from-improved.js"></script>
  <script defer src="./script/render/where-tree.js"></script>

  <!-- Subquery modal -->
  <script defer src="./script/modal.js"></script>

  <!-- App -->
  <script defer src="./script/app.js"></script>

  <!-- Theme (no layout re-wiring; keep your original DOM/rendering) -->
  <script>
    (function () {
      const root = document.documentElement;
      const key = 'tools_theme';

      function getSystemTheme() {
        return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }

      function applyTheme(theme) {
        root.setAttribute('data-theme', theme);
        const btn = document.getElementById('btnThemeToggle');
        if (btn) {
          const ico = btn.querySelector('.btn-ico');
          if (ico) ico.textContent = theme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
        }
      }

      const saved = localStorage.getItem(key);
      applyTheme(saved || getSystemTheme());

      document.addEventListener('click', (e) => {
        const btn = e.target && (e.target.closest ? e.target.closest('#btnThemeToggle') : null);
        if (!btn) return;
        const cur = root.getAttribute('data-theme') || getSystemTheme();
        const next = cur === 'dark' ? 'light' : 'dark';
        localStorage.setItem(key, next);
        applyTheme(next);
      });

      if (!saved && window.matchMedia) {
        const mq = window.matchMedia('(prefers-color-scheme: dark)');
        const handler = () => {
          if (localStorage.getItem(key)) return;
          applyTheme(getSystemTheme());
        };
        try { mq.addEventListener('change', handler); } catch { mq.addListener(handler); }
      }
    })();
  </script>
</body>

</html>